{% extends "base.html" %}

{% block title %}{{ post.title }} – Fitness Club Blog{% endblock %}

{% block extra_css %}
<style>
  .blog-detail-container {
    max-width: 900px;
    margin: 30px auto;
    padding: 30px;
    background: white;
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }

  .blog-detail-container h1 {
    color: #2d6a4f;
    margin-bottom: 20px;
    font-size: 2.5rem;
  }

  .blog-post-meta {
    color: #666;
    font-size: 0.9rem;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 1px solid #eee;
  }

  .blog-post-image {
    max-width: 100%;
    height: auto;
    border-radius: 5px;
    margin-bottom: 25px;
  }

  /* Image Gallery Styles */
  .blog-image-gallery {
    margin-bottom: 30px;
  }

  .gallery-main {
    width: 100%;
    max-width: 800px;
    margin: 0 auto 15px;
    border: 1px solid #ddd;
    padding: 10px;
    box-sizing: border-box;
    text-align: center;
    background: #f9f9f9;
    border-radius: 5px;
  }

  .gallery-main img {
    max-width: 100%;
    max-height: 420px;
    height: auto;
    border-radius: 5px;
    object-fit: contain;
  }

  .gallery-thumbnails {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: center;
    margin-top: 15px;
  }

  .gallery-thumbnail {
    width: 100px;
    height: 100px;
    object-fit: cover;
    border: 2px solid #ddd;
    border-radius: 5px;
    cursor: pointer;
    transition: border-color 0.2s, transform 0.2s;
  }

  .gallery-thumbnail:hover {
    border-color: #2d6a4f;
    transform: scale(1.05);
  }

  .gallery-thumbnail.active {
    border-color: #2d6a4f;
    border-width: 3px;
  }

  .gallery-nav {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    margin-bottom: 15px;
  }

  .gallery-arrow {
    background: #2d6a4f;
    color: white;
    border: none;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    font-size: 1.5rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.2s;
  }

  .gallery-arrow:hover:not(:disabled) {
    background: #1b4332;
  }

  .gallery-arrow:disabled {
    background: #ccc;
    cursor: not-allowed;
    opacity: 0.5;
  }

  .blog-post-content {
    line-height: 1.8;
    color: #333;
    font-size: 1.1rem;
  }

  .blog-post-content p {
    margin-bottom: 20px;
  }

  .back-link {
    display: inline-block;
    margin-top: 30px;
    padding: 10px 20px;
    background: #2d6a4f;
    color: white;
    text-decoration: none;
    border-radius: 5px;
  }

  .back-link:hover {
    background: #1b4332;
  }
</style>
{% endblock %}

{% block content %}
<div class="blog-detail-container">
  <h1>{{ post.title }}</h1>
  
  <div class="blog-post-meta">
    Posted on: {{ post.published_date|date:"F d, Y" }} by {{ post.author }}
    {% if post.view_count > 0 %}
      | Views: {{ post.view_count }}
    {% endif %}
  </div>

  {# Display images: show featured_image first, then gallery images if they exist #}
  {% if post.featured_image or post.images.all %}
    <div class="blog-image-gallery">
      <div class="gallery-nav">
        <button class="gallery-arrow" id="gallery-prev" onclick="changeGalleryImage(-1)">‹</button>
        <div class="gallery-main" id="gallery-main">
          {% if post.featured_image %}
            <img id="gallery-main-img" src="{{ post.featured_image.url }}" alt="{{ post.title }}">
          {% elif post.images.all %}
            <img id="gallery-main-img" src="{{ post.images.first.image.url }}" alt="{{ post.images.first.alt_text|default:post.title }}">
          {% endif %}
        </div>
        <button class="gallery-arrow" id="gallery-next" onclick="changeGalleryImage(1)">›</button>
      </div>
      {% if post.images.all or post.featured_image %}
        <div class="gallery-thumbnails" id="gallery-thumbnails">
          {% if post.featured_image %}
            <img 
              src="{{ post.featured_image.url }}" 
              alt="{{ post.title }}" 
              class="gallery-thumbnail active"
              onclick="showGalleryImage(0)"
              data-index="0"
              data-src="{{ post.featured_image.url }}"
            >
          {% endif %}
          {% for image in post.images.all %}
            <img 
              src="{{ image.image.url }}" 
              alt="{{ image.alt_text|default:post.title }}" 
              class="gallery-thumbnail {% if not post.featured_image and forloop.first %}active{% endif %}"
              onclick="showGalleryImage({% if post.featured_image %}{{ forloop.counter }}{% else %}{{ forloop.counter0 }}{% endif %})"
              data-index="{% if post.featured_image %}{{ forloop.counter }}{% else %}{{ forloop.counter0 }}{% endif %}"
              data-src="{{ image.image.url }}"
            >
          {% endfor %}
        </div>
      {% endif %}
    </div>
  {% endif %}

  {% if post.excerpt %}
    <p style="font-style: italic; color: #555; font-size: 1.2rem; margin-bottom: 25px;">{{ post.excerpt }}</p>
  {% endif %}

  <div class="blog-post-content">
    {{ post.content|safe }}
  </div>

  <a href="{% url 'core:blog' %}" class="back-link">← Back to Blog</a>
</div>

<script>
  let currentGalleryIndex = 0;
  const galleryImages = [];
  {% if post.featured_image %}
    galleryImages.push({
      src: "{{ post.featured_image.url }}",
      alt: "{{ post.title|escapejs }}"
    });
  {% endif %}
  {% for image in post.images.all %}
    galleryImages.push({
      src: "{{ image.image.url }}",
      alt: "{{ image.alt_text|default:post.title|escapejs }}"
    });
  {% endfor %}

  function showGalleryImage(index) {
    if (index < 0 || index >= galleryImages.length) return;
    
    currentGalleryIndex = index;
    const mainImg = document.getElementById('gallery-main-img');
    const thumbnails = document.querySelectorAll('.gallery-thumbnail');
    
    // Update main image
    mainImg.src = galleryImages[index].src;
    mainImg.alt = galleryImages[index].alt;
    
    // Update thumbnail active state
    thumbnails.forEach((thumb, i) => {
      if (i === index) {
        thumb.classList.add('active');
      } else {
        thumb.classList.remove('active');
      }
    });
    
    // Update arrow states
    document.getElementById('gallery-prev').disabled = index === 0;
    document.getElementById('gallery-next').disabled = index === galleryImages.length - 1;
  }

  function changeGalleryImage(direction) {
    const newIndex = currentGalleryIndex + direction;
    if (newIndex >= 0 && newIndex < galleryImages.length) {
      showGalleryImage(newIndex);
    }
  }

  // Initialize gallery on page load
  if (galleryImages.length > 0) {
    document.addEventListener('DOMContentLoaded', function() {
      showGalleryImage(0);
    });
  }
</script>
{% endblock %}

