
{% extends "base.html" %}

{% block title %}Your Cart – Fitness Club{% endblock %}

{% block extra_css %}

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #d8f3dc;   /* light green */
        }

        h1 {
            margin-bottom: 10px;
        }

        /* Top nav & account area */
        .top-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .nav-links a {
            margin-right: 15px;
            font-weight: bold;
        }
        .account-area {
            padding: 4px 8px;
            border-radius: 4px;
            background: #eef;
            font-size: 0.9rem;
        }
        .account-area a {
            font-weight: normal;
        }

        table {
            border-collapse: collapse;
            margin-top: 15px;
        }
        th, td {
            border: 1px solid #000;
            padding: 6px 10px;
            text-align: center;
        }

        .product-img {
            width: 70px;
            height: 70px;
            object-fit: cover;
        }

        .total-box {
            margin-top: 15px;
        }
        .total-box p {
            margin: 3px 0;
        }
        .total-box strong {
            font-size: 1.05rem;
        }

        .cart-links {
            margin-top: 20px;
        }
        .cart-links a {
            display: inline-block;
            margin-right: 20px;
        }
    </style>

{% endblock %}

{% block content %}


<header>
    <h1>Your Cart</h1>

    
    <hr>
</header>

{% if items %}
    <table>
        <thead>
            <tr>
                <th>Image</th>
                <th>Product</th>
                <th>Quantity</th>
                <th>Line Total</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            {% for item in items %}
                <tr>
                    <td>
                        {% if item.product.main_image %}
                            <img src="{{ item.product.main_image }}" alt="{{ item.product.name }}" class="product-img">
                        {% elif item.product.image %}
                            <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}" class="product-img">
                        {% else %}
                            (no image)
                        {% endif %}
                    </td>
                    <td>{{ item.product.name }}</td>
                    <td>
                        <form action="{% url 'cart:add_to_cart' item.product.id %}" method="post" class="cart-update-form">
                            {% csrf_token %}
                            <input
                                type="number"
                                name="quantity"
                                value="{{ item.quantity }}"
                                min="1"
                                style="width:50px;"
                                class="qty-input"
                            >
                            <input type="hidden" name="override" value="True">
                            {# No visible button needed now #}
                        </form>
                    </td>

                    <td>{{ item.line_total }}</td>
                    <td>
                        <a href="{% url 'cart:remove_from_cart' item.product.pk %}">Remove</a>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="total-box">
        <p>Subtotal: <strong>${{ subtotal }}</strong></p>
        <p>GST/HST (5%): <strong>${{ tax }}</strong></p>
        <p>Total with tax: <strong>${{ total_with_tax }}</strong></p>
    </div>

    <div class="cart-links">
        <a href="{% url 'payment:checkout' %}">Proceed to Payment</a>
        <a href="{% url 'home:home' %}">Continue Shopping</a>
    </div>

{% else %}
    <p>Your cart is empty.</p>
    <a href="{% url 'home:home' %}">Continue Shopping</a>
{% endif %}
<script>
document.addEventListener('DOMContentLoaded', function () {
    // When the quantity changes, submit that row's form automatically
    document.querySelectorAll('.qty-input').forEach(function (input) {
        input.addEventListener('change', function () {
            let value = parseInt(this.value, 10);

            // prevent zero / negative / NaN
            if (isNaN(value) || value < 1) {
                this.value = 1;
            }

            this.form.submit();
        });

        // Optional: also submit on Enter key, even before leaving the field
        input.addEventListener('keydown', function (e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                this.dispatchEvent(new Event('change'));
            }
        });
    });
});
</script>

<p class="shipping-note" style="margin-top:10px; font-size:0.9rem; color:#555;">
    <em>
        Shipping information:<br>
        • Physical products – flat $15 shipping fee (free for orders over $100).<br>
        • Digital and service products – no shipping charges.<br>
        Final shipping will be calculated at checkout.
    </em>
</p>


{% endblock %}