  {% extends "base.html" %}

   {% block title %}{{ product.name }} â€“ My Fitness Club{% endblock %}


    {% block extra_css %}

    
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        a {
            color: purple;
        }
        header {
            margin-bottom: 20px;
        }
        nav a {
            margin-right: 15px;
            font-weight: bold;
        }
        h1, h2, h3 {
            margin-bottom: 10px;
        }
        button {
            padding: 8px 15px;
            font-size: 1rem;
        }

        /* Page layout: single column for content */
        .page-wrapper {
            max-width: 1000px;
            margin: 0 auto;
        }

        /* Carousel area */
        .media-section {
            margin-top: 20px;
        }
        .media-carousel {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .nav-arrow {
            background: #f5f5f5;
            border: 1px solid #ccc;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            cursor: pointer;
            font-size: 1.5rem;
            line-height: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .nav-arrow:disabled {
            opacity: 0.4;
            cursor: default;
        }

        .main-media-wrapper {
            width: 100%;
            max-width: 550px;
            border: 1px solid #ddd;
            padding: 30px 10px;
            box-sizing: border-box;
            text-align: center;
            background: white;
        }
        .main-media-wrapper img,
        .main-media-wrapper video {
            max-width: 100%;
            max-height: 450px;
            object-fit: cover;
        }

        /* Thumbnails row */
        .thumbnail-row {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
            justify-content: center;
        }
        .thumb {
            width: 70px;
            height: 70px;
            border: 1px solid #ccc;
            padding: 2px;
            box-sizing: border-box;
            cursor: pointer;
            object-fit: cover;
        }
        .thumb video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .thumb.video-thumb-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            background: #000;
            color: #fff;
        }
        .thumb.active {
            border: 2px solid #000;
        }

        /* Buy box at very bottom */
        .buy-box {
            margin-top: 30px;
            border: 1px solid #ddd;
            padding: 15px;
            box-sizing: border-box;
        }
        .product-price {
            font-size: 1.4rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .meta {
            color: #555;
            font-size: 0.9rem;
            margin-bottom: 4px;
        }
    </style>

{% endblock %}

{% block content %}

<div id="page-top"></div>

<header>
    <h1>My Fitness Club</h1>
    
    <hr>
</header>

<div class="page-wrapper" id="product-content">

    <!-- 1. Product name -->
    <h2>{{ product.name }}</h2>

    <!-- tiny meta info -->
    {% if product.category %}
        <div class="meta">Category: {{ product.category.name }}</div>
    {% endif %}
    <div class="meta">In stock: {{ product.quantity_in_stock }}</div>

    <!-- 2. Description under name -->
    <h3>Description</h3>
    {% if product.is_service %}
    <section style="margin-top: 15px; padding: 10px; border: 1px dashed #aaa;">
        <h3>Class Information</h3>
        {% if product.service_date %}
            <p><strong>Date:</strong> {{ product.service_date }}</p>
        {% endif %}
        {% if product.service_time %}
            <p><strong>Time:</strong> {{ product.service_time }}</p>
        {% endif %}
        {% if product.service_duration_minutes %}
            <p><strong>Duration:</strong> {{ product.service_duration_minutes }} minutes</p>
        {% endif %}
        {% if product.service_location %}
            <p><strong>Location:</strong> {{ product.service_location }}</p>
        {% endif %}
        <p><em>This is a service product (class booking). No physical item will be shipped.</em></p>
    </section>
    {% endif %}

    <p>{{ product.description|linebreaksbr }}</p>

    <!-- 3. Media carousel (images + videos together) -->
    <section class="media-section">
        <div class="media-carousel">
            <button class="nav-arrow" id="arrow-left">â€¹</button>

 <div class="main-media-wrapper">
    <div id="main-media">
        {% comment %}
        Weâ€™ll let JS pick the first slide based on thumbnails.
        {% endcomment %}

        {% if not product.images.all and not product.videos.all and not product.audios.all %}
            <img src="/static/no-image.png" alt="No media">
        {% endif %}
    </div>
</div>



            <button class="nav-arrow" id="arrow-right">â€º</button>
        </div>

        <div class="thumbnail-row" id="thumbnail-row">
    {# Image thumbnails #}
    {% for image in product.images.all %}
        <img
            src="{{ image.image.url }}"
            class="thumb slide-thumb"
            data-type="image"
            data-src="{{ image.image.url }}"
            alt="{{ image.alt_text|default:product.name }}"
        >
    {% endfor %}

    {# Video thumbnails (file or URL) #}
    {% for video in product.videos.all %}
        {% if video.video_file %}
            <div
                class="thumb slide-thumb video-thumb-icon"
                data-type="video"
                data-src="{{ video.video_file.url }}"
                title="{{ video.title|default:'Video' }}"
            >â–¶</div>
        {% elif video.video_url %}
            <div
                class="thumb slide-thumb video-thumb-icon"
                data-type="video"
                data-src="{{ video.video_url }}"
                title="{{ video.title|default:'Video' }}"
            >â–¶</div>
        {% endif %}
    {% endfor %}

    {# Audio thumbnails #}
    {% for audio in product.audios.all %}
        {% if audio.audio_file %}
            <div
                class="thumb slide-thumb video-thumb-icon"
                data-type="audio"
                data-src="{{ audio.audio_file.url }}"
                title="{{ audio.title|default:'Audio' }}"
            >ðŸŽµ</div>
        {% elif audio.audio_url %}
            <div
                class="thumb slide-thumb video-thumb-icon"
                data-type="audio"
                data-src="{{ audio.audio_url }}"
                title="{{ audio.title|default:'Audio' }}"
            >ðŸŽµ</div>
        {% endif %}
    {% endfor %}

</div>

    </section>

   
<!-- 5. Price + add to cart at the very bottom -->
<div class="buy-box">
    <div class="product-price">
        ${{ product.price }}
    </div>

    {# ---------- Availability display ---------- #}
    {% if product.is_service %}
        {# Service product: use service_seats #}
        {% if product.service_seats is not None %}
            {% if product.service_seats > 0 %}
                <p>Available</p>
                <p style="font-size: 0.9em; color:#555;">
                    Seats left: {{ product.service_seats }}
                </p>
            {% else %}
                <p style="color:red; font-weight:bold;">Unavailable</p>
            {% endif %}
        {% else %}
            {# Unlimited seats (no limit set) #}
            <p>Available</p>
        {% endif %}

    {% elif product.is_digital %}
        {# Digital product: always available #}
        <p>Available (digital product â€“ no stock limit)</p>

    {% else %}
        {# Physical product: use quantity_in_stock #}
        {% if product.quantity_in_stock > 0 %}
            <p>Available</p>
            <p style="font-size: 0.9em; color:#555;">
                In stock: {{ product.quantity_in_stock }}
            </p>
        {% else %}
            <p style="color:red; font-weight:bold;">Unavailable</p>
        {% endif %}
    {% endif %}

    {# ---------- Add to cart / book button ---------- #}

    {% if product.is_service %}
        {# Service: one seat per booking #}
        {% if product.service_seats is not None and product.service_seats <= 0 %}
            <button type="button" disabled style="margin-top:10px;">Unavailable</button>
        {% else %}
            <form action="{% url 'cart:add_to_cart' product.id %}" method="post" style="margin-top:10px;">
                {% csrf_token %}
                <input type="hidden" name="quantity" value="1">
                <button type="submit">Book this class</button>
            </form>
        {% endif %}

    {% elif product.is_digital %}
        {# Digital: one download per order #}
        <form action="{% url 'cart:add_to_cart' product.id %}" method="post" style="margin-top:10px;">
            {% csrf_token %}
            <input type="hidden" name="quantity" value="1">
            <button type="submit">Add to Cart</button>
        </form>

    {% else %}
        {# Physical product #}
        {% if product.quantity_in_stock > 0 %}
            <form action="{% url 'cart:add_to_cart' product.id %}" method="post" style="margin-top:10px;">
                {% csrf_token %}
                <label for="quantity">Quantity:</label>
                <input type="number"
                       id="quantity"
                       name="quantity"
                       value="1"
                       min="1"
                       style="width:60px;">
                <button type="submit">Add to Cart</button>
            </form>
        {% else %}
            <button type="button" disabled style="margin-top:10px;">Unavailable</button>
        {% endif %}
    {% endif %}
</div>



</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    // Scroll to product content on page load (skip header/nav)
    // This prevents the page from starting at the very top
    const productContent = document.getElementById('product-content');
    if (productContent) {
        // Small delay to ensure page is fully rendered
        setTimeout(function() {
            productContent.scrollIntoView({ behavior: 'smooth', block: 'start' });
            // If smooth scroll doesn't work, use instant scroll as fallback
            if (window.scrollY === 0) {
                window.scrollTo(0, productContent.offsetTop - 20);
            }
        }, 100);
    }

    const mainMedia = document.getElementById('main-media');
    const thumbs = Array.from(document.querySelectorAll('.slide-thumb'));
    const arrowLeft = document.getElementById('arrow-left');
    const arrowRight = document.getElementById('arrow-right');

    if (!thumbs.length) {
        arrowLeft.disabled = true;
        arrowRight.disabled = true;
        return;
    }

    // Build slides array from thumbnails
    const slides = thumbs.map(thumb => ({
        type: thumb.dataset.type,
        src: thumb.dataset.src
    }));

    let currentIndex = 0;

    function renderSlide(index) {
        const slide = slides[index];
        if (!slide) return;

        if (slide.type === 'image') {
            mainMedia.innerHTML = `<img src="${slide.src}" alt="Product image">`;
        }
        else if (slide.type === 'video') {
            mainMedia.innerHTML =
                `<video controls>
                    <source src="${slide.src}">
                    Your browser does not support the video tag.
                 </video>`;
        }
        else if (slide.type === 'audio') {
            mainMedia.innerHTML =
                `<audio controls style="width:100%;">
                    <source src="${slide.src}">
                    Your browser does not support the audio element.
                 </audio>`;
        }

        // highlight active thumb
        thumbs.forEach(t => t.classList.remove('active'));
        thumbs[index].classList.add('active');
    }

    // Initial slide
    renderSlide(currentIndex);

    // Thumbnail click handler
    thumbs.forEach((thumb, idx) => {
        thumb.addEventListener('click', function () {
            currentIndex = idx;
            renderSlide(currentIndex);
        });
    });

    // Left arrow
    arrowLeft.addEventListener('click', function () {
        currentIndex = (currentIndex - 1 + slides.length) % slides.length;
        renderSlide(currentIndex);
    });

    // Right arrow
    arrowRight.addEventListener('click', function () {
        currentIndex = (currentIndex + 1) % slides.length;
        renderSlide(currentIndex);
    });

});
</script>


{% endblock %}
