{% extends "base.html" %}

{% block content %}

<style>
    .membership-card {
        max-width: 800px;
        margin: 20px auto;
        background: #ffffff;
        border-radius: 10px;
        padding: 20px 25px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .membership-card h1 {
        text-align: center;
        color: #1b4332;
    }

    .plans {
        display: flex;
        gap: 20px;
        margin-top: 20px;
        flex-wrap: wrap;
    }

    .plan {
        flex: 1 1 250px;
        border: 1px solid #b7e4c7;
        border-radius: 8px;
        padding: 15px;
        background: #f8f9fa;
    }

    .plan h3 {
        margin-top: 0;
    }

    .current-status {
        margin-top: 20px;
        padding: 10px;
        background: #e9f5e9;
        border-left: 4px solid #2d6a4f;
    }

    .cancel-btn {
        background-color: #e0e0e0;
        color: #333;
        border: 1px solid #bbb;
        padding: 8px 14px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 0.9rem;
    }

    .cancel-btn:hover {
        background: #9d0208;
    }

    .btn {
    padding: 8px 14px;
    border-radius: 6px;
    border: 1px solid #999;
    cursor: pointer;
    }

    .btn-primary {
    background: #f7f7f7;
    }

    .btn-disabled {
    background: #e9e9e9;
    color: #777;
    cursor: not-allowed;
    }

    .btn-cancel {
    background: #e0e0e0;
    color: #444;
    border: 1px solid #888;
    }

    .btn-cancel:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    }
    
    
</style>

<div class="membership-card">
    <h1>My Membership</h1>

    <div class="current-status">
     {% if profile.is_active_member %}
        <p><strong>Status:</strong> Active</p>
        <p><strong>Level:</strong> {{ profile.get_membership_level_display }}</p>

        {% if profile.membership_expires %}
            <p><strong>Current period ends on:</strong> {{ profile.membership_expires|date:"Y-m-d" }}</p>
        {% endif %}

        {% if profile.auto_renew %}
            <p><strong>Auto billing:</strong> ON</p>

            {% if profile.next_billing_date %}
                <p><strong>Next billing date:</strong> {{ profile.next_billing_date|date:"Y-m-d" }}</p>
            {% else %}
                <p><strong>Next billing date:</strong> To be scheduled</p>
            {% endif %}

            <p style="font-size: 0.9em; color: #555;">
                This membership is set to renew automatically every month until you cancel.
                (Billing is handled manually by staff in this demo.)
            </p>

            <!-- âœ… Cancel button -->
            

        {% else %}
            <p><strong>Auto billing:</strong> OFF</p>
            <p style="font-size: 0.9em; color: #555;">
                This membership does not auto-renew. You can renew it manually at the front desk.
            </p>
        {% endif %}

    {% elif profile.membership_level != "none" %}
        <p><strong>Status:</strong> Expired</p>
        <p><strong>Last Level:</strong> {{ profile.get_membership_level_display }}</p>
    {% else %}
        <p><strong>Status:</strong> No active membership</p>
    {% endif %}
    </div>
</div>



    <h2>Membership Plans (description only for now)</h2>

    <div class="plans">

  <!-- BASIC -->
  <div class="plan">
    <h3>Facility Only</h3>
    <p>Unlimited access to fitness facility and gym equipment.</p>
    <p><strong>${{ basic_price }}/month</strong></p>
    <p>Great for members who want to train independently.</p>

    {% if profile.is_active_member %}
        {% if profile.membership_level == "basic" %}
            <button class="btn btn-disabled" disabled>Current Plan</button>
        {% else %}
            <form method="post">
                {% csrf_token %}
                <button type="submit" name="switch_to_basic" class="btn btn-primary">
                    Switch to Basic
                </button>
            </form>
        {% endif %}
    {% else %}
        <form method="post">
            {% csrf_token %}
            <button type="submit" name="subscribe_basic" class="btn btn-primary">
                Subscribe
            </button>
        </form>
    {% endif %}
  </div>

  <!-- PREMIUM -->
  <div class="plan">
    <h3>Facility + Classes</h3>
    <p>Unlimited access to fitness facility + all in-class training and group lessons.</p>
    <p><strong>${{ premium_price }}/month</strong></p>
    <p>Best choice for members who want coached classes + open gym.</p>

    {% if profile.is_active_member %}
        {% if profile.membership_level == "premium" %}
            <button class="btn btn-disabled" disabled>Current Plan</button>
        {% else %}
            <form method="post">
                {% csrf_token %}
                <button type="submit" name="switch_to_premium" class="btn btn-primary">
                    Switch to Premium
                </button>
            </form>
        {% endif %}
    {% else %}
        <form method="post">
            {% csrf_token %}
            <button type="submit" name="subscribe_premium" class="btn btn-primary">
                Subscribe
            </button>
        </form>
    {% endif %}
  </div>

</div>


  {% if profile.is_active_member %}
  <form method="post" style="margin-top: 30px;">
    {% csrf_token %}

    {% if profile.auto_renew %}
      <button type="submit" name="cancel_membership"
              style="background:#ccc;color:#555;">
        Cancel Subscription
      </button>
    {% else %}
      <button type="submit" name="resume_membership">
        Resume Subscription
      </button>
    {% endif %}
  </form>
{% endif %}



{% endblock %}